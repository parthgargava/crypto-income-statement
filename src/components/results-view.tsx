"use client";

import { Button } from "@/components/ui/button";
import { Download, Printer, RotateCcw } from "lucide-react";
import type { CategorizedTransaction } from "@/types";
import { IncomeSummary } from "./income-summary";
import { TransactionTable } from "./transaction-table";
import { PortfolioInsights } from "./portfolio-insights";
import { Logo } from "./logo";

interface ResultsViewProps {
  transactions: CategorizedTransaction[];
  onReset: () => void;
  onUpdateTransaction: (transaction: CategorizedTransaction) => void;
}

export function ResultsView({ transactions, onReset, onUpdateTransaction }: ResultsViewProps) {
  
  const handleExportJson = () => {
    const jsonString = `data:text/json;charset=utf-8,${encodeURIComponent(
      JSON.stringify({
        reportTitle: "Calico Crypto Statement Income Report",
        generatedAt: new Date().toISOString(),
        transactions,
      }, null, 2)
    )}`;
    const link = document.createElement("a");
    link.href = jsonString;
    link.download = "calico-crypto-statement-report.json";
    link.click();
  };
  
  const handlePrint = () => {
    window.print();
  };

  return (
    <div className="space-y-8 print:space-y-4 p-10">
      <header className="flex flex-col gap-6 md:flex-row md:items-center md:justify-between print:hidden">
        <Logo />
        <div className="flex items-center gap-3">
          <Button variant="outline" onClick={handlePrint} className="calico-button-secondary">
            <Printer className="mr-2 h-4 w-4" />Print PDF
          </Button>
          <Button variant="outline" onClick={handleExportJson} className="calico-button-secondary">
            <Download className="mr-2 h-4 w-4" />Export JSON
          </Button>
          <Button onClick={onReset} className="calico-button">
            <RotateCcw className="mr-2 h-4 w-4" />Start Over
          </Button>
        </div>
      </header>

      <div className="print:hidden">
        <IncomeSummary transactions={transactions} />
      </div>

      <div className="print:hidden">
        <PortfolioInsights transactions={transactions} />
      </div>

      <div className="calico-card p-6">
        <h2 className="calico-heading mb-6">Transaction History</h2>
        <TransactionTable transactions={transactions} onUpdateTransaction={onUpdateTransaction} />
      </div>

      <footer className="hidden print:block text-center text-xs text-muted-foreground pt-4">
        Report generated by Calico Crypto Statement on {new Date().toLocaleDateString()}.
      </footer>
    </div>
  );
}
